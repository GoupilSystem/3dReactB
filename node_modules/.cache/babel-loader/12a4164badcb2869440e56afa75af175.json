{"ast":null,"code":"import _slicedToArray from \"C:\\\\Users\\\\scarleti\\\\Desktop\\\\Cyril\\\\React\\\\3dHoverBis\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport { useContext, useRef, useState, createElement, createContext } from 'react';\nimport { Object3D, Matrix4, Quaternion, Vector3, Scene } from 'three';\nimport { useThree, useFrame, createPortal } from 'react-three-fiber';\nimport { OrthographicCamera } from './OrthographicCamera.js';\nimport { useCamera } from './useCamera.js';\nconst Context = /*#__PURE__*/createContext({});\n\nconst useGizmoContext = () => {\n  return useContext(Context);\n};\n\nconst turnRate = 2 * Math.PI; // turn rate in angles per second\n\nconst dummy = new Object3D();\nconst matrix = new Matrix4();\nconst q1 = new Quaternion(),\n      q2 = new Quaternion();\nconst target = new Vector3();\nconst targetPosition = new Vector3();\nconst targetQuaternion = new Quaternion();\n\nconst GizmoHelper = ({\n  alignment = 'bottom-right',\n  margin = [80, 80],\n  onUpdate,\n  onTarget,\n  children: GizmoHelperComponent\n}) => {\n  const _useThree = useThree(),\n        gl = _useThree.gl,\n        mainCamera = _useThree.camera,\n        size = _useThree.size;\n\n  const gizmoRef = useRef();\n  const virtualCam = useRef(null);\n\n  const _useState = useState(() => new Scene()),\n        _useState2 = _slicedToArray(_useState, 1),\n        virtualScene = _useState2[0];\n\n  const animating = useRef(false);\n  const radius = useRef(0);\n  const focusPoint = useRef(new Vector3(0, 0, 0));\n\n  const tweenCamera = direction => {\n    animating.current = true;\n    focusPoint.current = onTarget();\n    radius.current = mainCamera.position.distanceTo(target); // Rotate from current camera orientation\n\n    dummy.position.copy(target);\n    dummy.lookAt(mainCamera.position);\n    q1.copy(dummy.quaternion); // To new current camera orientation\n\n    targetPosition.copy(direction).multiplyScalar(radius.current).add(target);\n    dummy.lookAt(targetPosition);\n    q2.copy(dummy.quaternion);\n  };\n\n  const animateStep = delta => {\n    if (!animating.current) return;\n    const step = delta * turnRate; // animate position by doing a slerp and then scaling the position on the unit sphere\n\n    q1.rotateTowards(q2, step);\n    mainCamera.position.set(0, 0, 1).applyQuaternion(q1).multiplyScalar(radius.current).add(focusPoint.current); // animate orientation\n\n    mainCamera.quaternion.rotateTowards(targetQuaternion, step);\n    mainCamera.updateProjectionMatrix();\n    onUpdate && onUpdate();\n\n    if (q1.angleTo(q2) < 0.01) {\n      animating.current = false;\n    }\n  };\n\n  const beforeRender = () => {\n    var _gizmoRef$current; // Sync gizmo with main camera orientation\n\n\n    matrix.copy(mainCamera.matrix).invert();\n    (_gizmoRef$current = gizmoRef.current) == null ? void 0 : _gizmoRef$current.quaternion.setFromRotationMatrix(matrix);\n  };\n\n  useFrame((_, delta) => {\n    if (virtualCam.current && gizmoRef.current) {\n      animateStep(delta);\n      beforeRender();\n      gl.autoClear = false;\n      gl.clearDepth();\n      gl.render(virtualScene, virtualCam.current);\n    }\n  });\n  const gizmoHelperContext = {\n    tweenCamera,\n    raycast: useCamera(virtualCam)\n  }; // Position gizmo component within scene\n\n  const _margin = _slicedToArray(margin, 2),\n        marginX = _margin[0],\n        marginY = _margin[1];\n\n  const x = alignment.endsWith('-left') ? -size.width / 2 + marginX : size.width / 2 - marginX;\n  const y = alignment.startsWith('top-') ? size.height / 2 - marginY : -size.height / 2 + marginY;\n  return createPortal( /*#__PURE__*/createElement(Context.Provider, {\n    value: gizmoHelperContext\n  }, /*#__PURE__*/createElement(OrthographicCamera, {\n    ref: virtualCam,\n    makeDefault: false,\n    position: [0, 0, 100]\n  }), /*#__PURE__*/createElement(\"group\", {\n    ref: gizmoRef,\n    position: [x, y, 0]\n  }, GizmoHelperComponent)), virtualScene);\n};\n\nexport { GizmoHelper, useGizmoContext };","map":null,"metadata":{},"sourceType":"module"}