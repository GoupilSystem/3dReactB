{"ast":null,"code":"import { EventDispatcher, Quaternion, Vector3 } from '../../../build/three.module.js';\n\nvar FlyControls = function FlyControls(object, domElement) {\n  if (domElement === undefined) {\n    console.warn('THREE.FlyControls: The second parameter \"domElement\" is now mandatory.');\n    domElement = document;\n  }\n\n  this.object = object;\n  this.domElement = domElement;\n  if (domElement) this.domElement.setAttribute('tabindex', -1); // API\n\n  this.movementSpeed = 1.0;\n  this.rollSpeed = 0.005;\n  this.dragToLook = false;\n  this.autoForward = false; // disable default target object behavior\n  // internals\n\n  var scope = this;\n  var changeEvent = {\n    type: 'change'\n  };\n  var EPS = 0.000001;\n  this.tmpQuaternion = new Quaternion();\n  this.mouseStatus = 0;\n  this.moveState = {\n    up: 0,\n    down: 0,\n    left: 0,\n    right: 0,\n    forward: 0,\n    back: 0,\n    pitchUp: 0,\n    pitchDown: 0,\n    yawLeft: 0,\n    yawRight: 0,\n    rollLeft: 0,\n    rollRight: 0\n  };\n  this.moveVector = new Vector3(0, 0, 0);\n  this.rotationVector = new Vector3(0, 0, 0);\n\n  this.keydown = function (event) {\n    if (event.altKey) {\n      return;\n    } //event.preventDefault();\n\n\n    switch (event.code) {\n      case 'ShiftLeft':\n      case 'ShiftRight':\n        this.movementSpeedMultiplier = .1;\n        break;\n\n      case 'KeyW':\n        this.moveState.forward = 1;\n        break;\n\n      case 'KeyS':\n        this.moveState.back = 1;\n        break;\n\n      case 'KeyA':\n        this.moveState.left = 1;\n        break;\n\n      case 'KeyD':\n        this.moveState.right = 1;\n        break;\n\n      case 'KeyR':\n        this.moveState.up = 1;\n        break;\n\n      case 'KeyF':\n        this.moveState.down = 1;\n        break;\n\n      case 'ArrowUp':\n        this.moveState.pitchUp = 1;\n        break;\n\n      case 'ArrowDown':\n        this.moveState.pitchDown = 1;\n        break;\n\n      case 'ArrowLeft':\n        this.moveState.yawLeft = 1;\n        break;\n\n      case 'ArrowRight':\n        this.moveState.yawRight = 1;\n        break;\n\n      case 'KeyQ':\n        this.moveState.rollLeft = 1;\n        break;\n\n      case 'KeyE':\n        this.moveState.rollRight = 1;\n        break;\n    }\n\n    this.updateMovementVector();\n    this.updateRotationVector();\n  };\n\n  this.keyup = function (event) {\n    switch (event.code) {\n      case 'ShiftLeft':\n      case 'ShiftRight':\n        this.movementSpeedMultiplier = 1;\n        break;\n\n      case 'KeyW':\n        this.moveState.forward = 0;\n        break;\n\n      case 'KeyS':\n        this.moveState.back = 0;\n        break;\n\n      case 'KeyA':\n        this.moveState.left = 0;\n        break;\n\n      case 'KeyD':\n        this.moveState.right = 0;\n        break;\n\n      case 'KeyR':\n        this.moveState.up = 0;\n        break;\n\n      case 'KeyF':\n        this.moveState.down = 0;\n        break;\n\n      case 'ArrowUp':\n        this.moveState.pitchUp = 0;\n        break;\n\n      case 'ArrowDown':\n        this.moveState.pitchDown = 0;\n        break;\n\n      case 'ArrowLeft':\n        this.moveState.yawLeft = 0;\n        break;\n\n      case 'ArrowRight':\n        this.moveState.yawRight = 0;\n        break;\n\n      case 'KeyQ':\n        this.moveState.rollLeft = 0;\n        break;\n\n      case 'KeyE':\n        this.moveState.rollRight = 0;\n        break;\n    }\n\n    this.updateMovementVector();\n    this.updateRotationVector();\n  };\n\n  this.mousedown = function (event) {\n    if (this.domElement !== document) {\n      this.domElement.focus();\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (this.dragToLook) {\n      this.mouseStatus++;\n    } else {\n      switch (event.button) {\n        case 0:\n          this.moveState.forward = 1;\n          break;\n\n        case 2:\n          this.moveState.back = 1;\n          break;\n      }\n\n      this.updateMovementVector();\n    }\n  };\n\n  this.mousemove = function (event) {\n    if (!this.dragToLook || this.mouseStatus > 0) {\n      var container = this.getContainerDimensions();\n      var halfWidth = container.size[0] / 2;\n      var halfHeight = container.size[1] / 2;\n      this.moveState.yawLeft = -(event.pageX - container.offset[0] - halfWidth) / halfWidth;\n      this.moveState.pitchDown = (event.pageY - container.offset[1] - halfHeight) / halfHeight;\n      this.updateRotationVector();\n    }\n  };\n\n  this.mouseup = function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (this.dragToLook) {\n      this.mouseStatus--;\n      this.moveState.yawLeft = this.moveState.pitchDown = 0;\n    } else {\n      switch (event.button) {\n        case 0:\n          this.moveState.forward = 0;\n          break;\n\n        case 2:\n          this.moveState.back = 0;\n          break;\n      }\n\n      this.updateMovementVector();\n    }\n\n    this.updateRotationVector();\n  };\n\n  this.update = function () {\n    var lastQuaternion = new Quaternion();\n    var lastPosition = new Vector3();\n    return function (delta) {\n      var moveMult = delta * scope.movementSpeed;\n      var rotMult = delta * scope.rollSpeed;\n      scope.object.translateX(scope.moveVector.x * moveMult);\n      scope.object.translateY(scope.moveVector.y * moveMult);\n      scope.object.translateZ(scope.moveVector.z * moveMult);\n      scope.tmpQuaternion.set(scope.rotationVector.x * rotMult, scope.rotationVector.y * rotMult, scope.rotationVector.z * rotMult, 1).normalize();\n      scope.object.quaternion.multiply(scope.tmpQuaternion);\n\n      if (lastPosition.distanceToSquared(scope.object.position) > EPS || 8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\n        scope.dispatchEvent(changeEvent);\n        lastQuaternion.copy(scope.object.quaternion);\n        lastPosition.copy(scope.object.position);\n      }\n    };\n  }();\n\n  this.updateMovementVector = function () {\n    var forward = this.moveState.forward || this.autoForward && !this.moveState.back ? 1 : 0;\n    this.moveVector.x = -this.moveState.left + this.moveState.right;\n    this.moveVector.y = -this.moveState.down + this.moveState.up;\n    this.moveVector.z = -forward + this.moveState.back; //console.log( 'move:', [ this.moveVector.x, this.moveVector.y, this.moveVector.z ] );\n  };\n\n  this.updateRotationVector = function () {\n    this.rotationVector.x = -this.moveState.pitchDown + this.moveState.pitchUp;\n    this.rotationVector.y = -this.moveState.yawRight + this.moveState.yawLeft;\n    this.rotationVector.z = -this.moveState.rollRight + this.moveState.rollLeft; //console.log( 'rotate:', [ this.rotationVector.x, this.rotationVector.y, this.rotationVector.z ] );\n  };\n\n  this.getContainerDimensions = function () {\n    if (this.domElement != document) {\n      return {\n        size: [this.domElement.offsetWidth, this.domElement.offsetHeight],\n        offset: [this.domElement.offsetLeft, this.domElement.offsetTop]\n      };\n    } else {\n      return {\n        size: [window.innerWidth, window.innerHeight],\n        offset: [0, 0]\n      };\n    }\n  };\n\n  function bind(scope, fn) {\n    return function () {\n      fn.apply(scope, arguments);\n    };\n  }\n\n  function contextmenu(event) {\n    event.preventDefault();\n  }\n\n  this.dispose = function () {\n    this.domElement.removeEventListener('contextmenu', contextmenu);\n    this.domElement.removeEventListener('mousedown', _mousedown);\n    this.domElement.removeEventListener('mousemove', _mousemove);\n    this.domElement.removeEventListener('mouseup', _mouseup);\n    window.removeEventListener('keydown', _keydown);\n    window.removeEventListener('keyup', _keyup);\n  };\n\n  var _mousemove = bind(this, this.mousemove);\n\n  var _mousedown = bind(this, this.mousedown);\n\n  var _mouseup = bind(this, this.mouseup);\n\n  var _keydown = bind(this, this.keydown);\n\n  var _keyup = bind(this, this.keyup);\n\n  this.domElement.addEventListener('contextmenu', contextmenu);\n  this.domElement.addEventListener('mousemove', _mousemove);\n  this.domElement.addEventListener('mousedown', _mousedown);\n  this.domElement.addEventListener('mouseup', _mouseup);\n  window.addEventListener('keydown', _keydown);\n  window.addEventListener('keyup', _keyup);\n  this.updateMovementVector();\n  this.updateRotationVector();\n};\n\nFlyControls.prototype = Object.create(EventDispatcher.prototype);\nFlyControls.prototype.constructor = FlyControls;\nexport { FlyControls };","map":null,"metadata":{},"sourceType":"module"}